

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>📈 Lab15 Sensor Calibration &#8212; Embedded Computer Systems I</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../_static/tabs.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Assignments/lab15_calibration';</script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="🔬 Lab 16 Tachometer" href="lab16.html" />
    <link rel="prev" title="🔬 Lab 15 ADC" href="lab15.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/ece382.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/ece382.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    ECE382 Embedded Computer Systems I
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Course Info</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus.html">🚩 Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schedule.html">📆 Course Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../assembly.html">🔧 Assembly</a></li>
<li class="toctree-l1"><a class="reference internal" href="../c_programming.html">💻 C Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">🙋 FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">💎 Resources</a></li>
<li class="toctree-l1"><a class="reference external" href="https://stanbaek.github.io/NoPointer.html">No Pointers in Python?</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Assignments</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="homework1.html">✏️ HW 1 Setting up CCS and Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="homework2.html">✏️ HW 2 Assembly Basic</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab2.html">🔬 Lab 2 Assembly Basic</a></li>
<li class="toctree-l1"><a class="reference internal" href="homework3.html">✏️ HW 3 Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab3.html">🔬 Lab 3 Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="homework4.html">✏️ HW 4 Subroutines</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab4.html">🔬 Lab 4 Subroutines</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab5.html">🔬 Lab 5 Software Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab8.html">🔬 Lab 8 I/O Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab10.html">🔬 Lab 10 Multithreading</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab11.html">🔬 Lab 11 Serial Ports</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab13.html">🔬 Lab 13 Timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab14.html">🔬 Lab 14 Real-Time Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab15.html">🔬 Lab 15 ADC</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">📈 Lab15 Sensor Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab16.html">🔬 Lab 16 Tachometer</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab17.html">🔬 Lab 17 Control Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="project.html">🚀 Final Project</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/USAFA-ECE/ece382/blob/master/docs/Assignments/lab15_calibration.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/USAFA-ECE/ece382" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/USAFA-ECE/ece382/issues/new?title=Issue%20on%20page%20%2FAssignments/lab15_calibration.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Assignments/lab15_calibration.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>📈 Lab15 Sensor Calibration</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#procedure">Procedure</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#record-actual-distance-and-adc-values">Record actual distance and ADC values</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#colab">Colab</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab15-sensor-calibration">
<h1>📈 Lab15 Sensor Calibration<a class="headerlink" href="#lab15-sensor-calibration" title="Permalink to this heading">#</a></h1>
<hr><section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this heading">#</a></h2>
<p>You will develop a function that converts raw ADC samples into distance from the object. Let <span class="math notranslate nohighlight">\(n\)</span> be a 14-bit sample from the ADC (0 to 16383) , and <span class="math notranslate nohighlight">\(d\)</span> be the distance in mm from the sensor to the object. Then the distance in mm from the sensor to the object is given by</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
d = \frac{m}{n - c}
\label{eq:dist_vs_adc} \tag{1}
\end{equation*}\]</div>
<p>where <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(c\)</span> are unknown variables (calibration coefficients) we need to empirically determine.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The goal is to find the calibration coefficients, <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(c\)</span>, that give us the best fitting line.</p>
</div>
</section>
<section id="procedure">
<h2>Procedure<a class="headerlink" href="#procedure" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><strong>Read this page thoroughly.</strong></p></li>
<li><p>Then, go to Colab by clicking the rocket icon at the top of this page and complete the sensor calibration. <strong>AR means action required in Colab</strong>.</p></li>
</ol>
<section id="record-actual-distance-and-adc-values">
<h3>Record actual distance and ADC values<a class="headerlink" href="#record-actual-distance-and-adc-values" title="Permalink to this heading">#</a></h3>
<p>Now let’s collect the ADC samples <span class="math notranslate nohighlight">\(N=(n_1, n_2, \dots, n_k)\)</span> for known distances, <span class="math notranslate nohighlight">\(D=(d_1, d_2, \dots, d_k)\)</span>.  Note that you need to collect the ADC data for distances from the sensors, not the center of the robot.  Place your robot on the paper ruler in the lab as shown in the figure below (the figure may not be displayed in Colab).  Place your robot at 0 cm and place the box of your robot at the desired distances to collect ADC data for the distances between the box and the sensors.</p>
<a class="reference internal image-reference" href="../_images/Lab15_MeasuringDistances.png"><img alt="../_images/Lab15_MeasuringDistances.png" class="align-center" src="../_images/Lab15_MeasuringDistances.png" style="width: 400px;" /></a>
<br>
<p>Record ADC values displayed on the LCD for distances between 80 mm and 600 mm.  You may need more data at close distances to the wall than at far distances. For example, you want to collect data at distances of <span class="math notranslate nohighlight">\(80, 100, ..., 280, 300, 350, 400, ..., 500, 550\)</span>, and <span class="math notranslate nohighlight">\(600\)</span> mm because your robot will be at a distance less than 300 mm most of the time and there is more noise as the distance becomes larger.</p>
<p>The more data you collect, the better the fitting line you will have.</p>
<p>Hints:</p>
<ul class="simple">
<li><p>Ensure your sensors are mounted straight up and facing the front/right/left.</p></li>
<li><p>Put your sensors at 0mm and place your box at different distances to collect the LCD data.  It would be much easier than putting your box at 0 mm and moving around your robot.</p></li>
<li><p>Use the same materials for the calibration and the demo.  For example, if you used a white box for your calibration, use the same box for the demo.  If you use the textbook instead, which is black, you will get different values. The black textbook will absorb some of the IR light.</p></li>
<li><p>If you have many outliers, you may want to retake the measurements at the distances you have outliers. Usually, the LCD values at 800 mm are not quite accurate and you can move on if it is the only outlier.</p></li>
</ul>
<p><strong>AR</strong>: Update D and N in the following code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># distances in mm from the left sensor to the wall</span>
<span class="c1"># more data gives you better estimate.</span>
<span class="c1"># TODO: Replace the distance values</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="mi">80</span><span class="p">,</span>
        <span class="mi">100</span><span class="p">,</span>
        <span class="mi">120</span><span class="p">,</span>
        <span class="mi">140</span><span class="p">,</span>
        <span class="mi">160</span><span class="p">,</span>
        <span class="mi">180</span><span class="p">,</span>
        <span class="mi">200</span><span class="p">,</span>
        <span class="mi">220</span><span class="p">,</span>
        <span class="mi">240</span><span class="p">,</span>
        <span class="mi">260</span><span class="p">,</span>
        <span class="mi">280</span><span class="p">,</span>
        <span class="mi">300</span><span class="p">,</span>
        <span class="mi">350</span><span class="p">,</span>
        <span class="mi">400</span><span class="p">,</span>
        <span class="mi">450</span><span class="p">,</span>
        <span class="mi">500</span><span class="p">,</span>
        <span class="mi">550</span><span class="p">,</span>
        <span class="mi">600</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># samples from the ADC for the distance you collected above.</span>
<span class="c1"># TODO: Replace the ADC values</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">(</span>
        <span class="mi">13643</span><span class="p">,</span>
        <span class="mi">11490</span><span class="p">,</span>
        <span class="mi">9205</span><span class="p">,</span>
        <span class="mi">8537</span><span class="p">,</span>
        <span class="mi">7722</span><span class="p">,</span>
        <span class="mi">6880</span><span class="p">,</span>
        <span class="mi">6514</span><span class="p">,</span>
        <span class="mi">6146</span><span class="p">,</span>
        <span class="mi">5742</span><span class="p">,</span>
        <span class="mi">5366</span><span class="p">,</span>
        <span class="mi">5084</span><span class="p">,</span>
        <span class="mi">4800</span><span class="p">,</span>
        <span class="mi">4306</span><span class="p">,</span>
        <span class="mi">3923</span><span class="p">,</span>
        <span class="mi">3547</span><span class="p">,</span>
        <span class="mi">3255</span><span class="p">,</span>
        <span class="mi">3066</span><span class="p">,</span>
        <span class="mi">2844</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original data&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;ADC sample&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;distance (mm)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f281b2d498dfced82745d91b277df52bfe0dfd67285a4f034aab793cc91617b6.png" src="../_images/f281b2d498dfced82745d91b277df52bfe0dfd67285a4f034aab793cc91617b6.png" />
</div>
</div>
<p>As shown in the figure above, the distance is a nonlinear function of ADC sample. To find a linear function, we can rewrite equation (1) into</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
n = m\frac{1}{d} + c
\end{equation*}\]</div>
<p>Let <span class="math notranslate nohighlight">\(d' = 1/d\)</span>. Then, we can obtain a linear equation given by</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
n = m d' + c
\label{eq:adc_vs_invdist} \tag{2}
\end{equation*}\]</div>
<p>which is a line equation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original data&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;inverse distance (1/mm)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;ADC sample&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f3b0eff1c45fef9f6681821b1ddbf400dac94f4f534fc982642ecacd269a8daf.png" src="../_images/f3b0eff1c45fef9f6681821b1ddbf400dac94f4f534fc982642ecacd269a8daf.png" />
</div>
</div>
<p>The above figure shows a linear relationship of the ADC sample and the inverse distance. Now we want to find <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(c\)</span> for the line <span class="math notranslate nohighlight">\(n = m d' + c\)</span> that best fits to the data in the figure.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following math is beyond the scope of ECE382. It will be discussed in ECE 487 and may be covered in Math 356/378 (linear regression) or Math 344/360 (linear least squares).</p>
</div>
<p>We can rewrite equation (2) in matrix form given by</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
n = \begin{bmatrix} d' &amp; 1 \end{bmatrix} \begin{bmatrix} m \\ c \end{bmatrix}
\label{eq:adc_vs_invdist_matrix} \tag{3}
\end{equation*}\]</div>
<p>For multiple ADC samples <span class="math notranslate nohighlight">\((n_1, n_2, \dots, n_k)\)</span>, we can obtain</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\begin{bmatrix} n_1 \\ n_2 \\ \vdots \\ n_k \end{bmatrix}  = \begin{bmatrix} d'_1 &amp; 1 \\ d'_2 &amp; 1 \\ \vdots &amp; \vdots \\ d'_k &amp; 1 \end{bmatrix} \begin{bmatrix} m \\ c \end{bmatrix}
\end{equation*}\]</div>
<p>As you may have noticed, it is a system of linear equations, which can be writen in simpler form</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\mathbf{N}  = \mathbf{C} \begin{bmatrix} m \\ c \end{bmatrix}
\end{equation*}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{N} = \begin{bmatrix} n_1 &amp; n_2 &amp; \dots &amp; n_k \end{bmatrix}^\top\)</span> and</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\mathbf{C}  = \begin{bmatrix} d'_1 &amp; 1 \\ d'_2 &amp; 1 \\ \vdots &amp; \vdots \\ d'_k &amp; 1 \end{bmatrix} 
\end{equation*}\]</div>
<p>As it was mentioned earlier, the goal is to find <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(c\)</span>.  Since it is an overdetermined system (more equations than unknowns), we cannot find <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(c\)</span> given by.</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\begin{bmatrix} m \\ c \end{bmatrix} = \mathbf{C}^{-1} \mathbf{N}  
\end{equation*}\]</div>
<p>Since <span class="math notranslate nohighlight">\(\mathbf{C}\)</span> is not a square matrix, there exists no inverse of <span class="math notranslate nohighlight">\(\mathbf{C}\)</span>.  For this case, we need to find the <em>psedoinverse</em> of <span class="math notranslate nohighlight">\(\mathbf{C}\)</span> given by</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\mathbf{C}^+ = (\mathbf{C}^\top \mathbf{C}) ^{-1}  \mathbf{C}^\top
\end{equation*}\]</div>
<p>Now we can find <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(c\)</span> by</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\begin{bmatrix} m \\ c \end{bmatrix} =  \mathbf{C}^+ \mathbf{N}   = (\mathbf{C}^\top \mathbf{C}) ^{-1}  \mathbf{C}^\top \mathbf{N}  
\end{equation*}\]</div>
<p>This method is called the least squares estimate (LSE).</p>
<p>Let’s create</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\mathbf{C}  = \begin{bmatrix} d'_1 &amp; 1 \\ d'_2 &amp; 1 \\ \vdots &amp; \vdots \\ d'_k &amp; 1 \end{bmatrix} 
\end{equation*}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="mi">1</span> <span class="o">/</span> <span class="n">D</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">))])</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
</div>
<p>We can use <code class="docutils literal notranslate"><span class="pre">np.linalg.lstsq()</span></code> for</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\begin{bmatrix} m \\ c \end{bmatrix} =  \mathbf{C}^+ \mathbf{N}   = (\mathbf{C}^\top \mathbf{C}) ^{-1}  \mathbf{C}^\top \mathbf{N}  
\end{equation*}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;m=</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">, c=</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>m=985686.6923961242, c=1445.0379980743394
</pre></div>
</div>
</div>
</div>
<p><strong>AR</strong> Record the <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(c\)</span> values for your <code class="docutils literal notranslate"><span class="pre">IRDistance.c</span></code>.  Take the integer values only.</p>
<p><strong>AR</strong> Rename the title of the  figure and the file name in the following code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Left IR Sensor&quot;</span><span class="p">)</span>  <span class="c1"># Rename the title of figure.</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original data&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">D</span><span class="p">,</span> <span class="n">m</span> <span class="o">/</span> <span class="n">D</span> <span class="o">+</span> <span class="n">c</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Fitted line&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;inverse distance (1/mm)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;ADC sample&quot;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original data&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">m</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">c</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Fitted line&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;ADC sample&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;distance (mm)&quot;</span><span class="p">)</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;Lab15_IRCalibLeft.png&quot;</span>  <span class="c1"># Rename the file name to save.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d1a2b9881879d795f0543414825bc825e170362f279e1dbf612e40c6056968b3.png" src="../_images/d1a2b9881879d795f0543414825bc825e170362f279e1dbf612e40c6056968b3.png" />
</div>
</div>
<p><strong>AR</strong> Uncommnet the following lines to download the figure.  You need to submit a figure for each distance sensor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import google.colab.files</span>
<span class="c1"># google.colab.files.download(filename)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="colab">
<h2>Colab<a class="headerlink" href="#colab" title="Permalink to this heading">#</a></h2>
<p>To run your code in Colab, click on the rocket icon at the top of this page. <img alt="Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Assignments"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="lab15.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">🔬 Lab 15 ADC</p>
      </div>
    </a>
    <a class="right-next"
       href="lab16.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">🔬 Lab 16 Tachometer</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#procedure">Procedure</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#record-actual-distance-and-adc-values">Record actual distance and ADC values</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#colab">Colab</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Stan Baek
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>