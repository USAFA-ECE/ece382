

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>üî¨ Lab 15 ADC &#8212; Embedded Computer Systems I</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../_static/tabs.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Assignments/lab15';</script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="üìà Lab15 Sensor Calibration" href="lab15_calibration.html" />
    <link rel="prev" title="üî¨ Lab 14 Real-Time Systems" href="lab14.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/ece382.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/ece382.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    ECE382 Embedded Computer Systems I
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Course Info</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus.html">üö© Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schedule.html">üìÜ Course Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../assembly.html">üîß Assembly</a></li>
<li class="toctree-l1"><a class="reference internal" href="../c_programming.html">üíª C Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">üôã FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">üíé Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NoPointer.html">‚ÜóÔ∏è No Pointers in Python?</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Assignments</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="homework1.html">‚úèÔ∏è HW 1 Setting up CCS and Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="homework2.html">‚úèÔ∏è HW 2 Assembly Basic</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab2.html">üî¨ Lab 2 Assembly Basic</a></li>
<li class="toctree-l1"><a class="reference internal" href="homework3.html">‚úèÔ∏è HW 3 Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab3.html">üî¨ Lab 3 Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="homework4.html">‚úèÔ∏è HW 4 Subroutines</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab4.html">üî¨ Lab 4 Subroutines</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab5.html">üî¨ Lab 5 Software Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab8.html">üî¨ Lab 8 I/O Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab10.html">üî¨ Lab 10 Multithreading</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab11.html">üî¨ Lab 11 Serial Ports</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab12.html">üî¨ Lab 12 Motors</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab13.html">üî¨ Lab 13 Timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab14.html">üî¨ Lab 14 Real-Time Systems</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">üî¨ Lab 15 ADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab15_calibration.html">üìà Lab15 Sensor Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab16.html">üî¨ Lab 16 Tachometer</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab17.html">üî¨ Lab 17 Control Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="project.html">üöÄ Final Project</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/USAFA-ECE/ece382" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/USAFA-ECE/ece382/issues/new?title=Issue%20on%20page%20%2FAssignments/lab15.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Assignments/lab15.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>üî¨ Lab 15 ADC</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">üìå Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">üìú Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#procedure">üíª Procedure</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#complete-functions-in-adc14-c">Complete functions in <code class="docutils literal notranslate"><span class="pre">ADC14.c</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#demo-program15-1">Demo <code class="docutils literal notranslate"><span class="pre">Program15_1()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calibrate-your-sensors">Calibrate your sensors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#complete-functions-in-irdistance-c">Complete functions in <code class="docutils literal notranslate"><span class="pre">IRDistance.c</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#write-and-test-the-classify-function">Write and test the <code class="docutils literal notranslate"><span class="pre">Classify()</span></code> function.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#demo-the-classify-function">Demo the <code class="docutils literal notranslate"><span class="pre">Classify()</span></code> function.</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverables-2-extra-points">üöö Deliverables (2 extra points)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverable-1">Deliverable 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverable-2">Deliverable 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverable-3">Deliverable 3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverable-4">Deliverable 4</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverable-5">Deliverable 5</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverable-6">Deliverable 6</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab-15-adc">
<h1>üî¨ Lab 15 ADC<a class="headerlink" href="#lab-15-adc" title="Permalink to this heading">#</a></h1>
<section id="objectives">
<h2>üìå Objectives<a class="headerlink" href="#objectives" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Students should be able to implement the ADC module to input analog data into the microcontroller.</p></li>
<li><p>Students should be able to use periodic interrupts to sample the ADC at a regular rate.</p></li>
<li><p>Students should be able to develop a function in C that converts raw ADC samples to distances.</p></li>
<li><p>Students should be able to evaluate the performance of the data acquisition system.</p></li>
<li><p>Students should be able to use an automated test approach called black-box functional testing to verify that their algorithm is operating correctly.</p></li>
<li><p>Students should be able to classify the states of the robot using the distance measurements from three sensors.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before software can be reusable, it first has to be usable.</p>
</div>
</section>
<section id="synopsis">
<h2>üìú Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this heading">#</a></h2>
<p>In this lab, we will perform the conversion of raw analog-to-digital converter (ADC) samples into distance measurements. We will use three separate conversion functions to process data from three IR distance sensors and calculate distances in millimeters. The IR distance sensors have a range of approximately 70 to 800 mm, with a resolution of about 1 mm at a distance of 200 mm.</p>
<p>The figure below illustrates the relationship between the output voltage of the IR sensor and the distance to the wall. It‚Äôs important to note that the sensor‚Äôs behavior is non-monotonic. For instance, if the sensor records a value of 2 V, it could correspond to either 30 mm or 120 mm. During the final project, the primary concern is to keep the robot at a safe distance from the wall, so we assume that the sensor distance is always greater than 70 mm. Additionally, given the nature of the maze navigation in the final project, we are not concerned with distances beyond 800 mm.</p>
<a class="reference internal image-reference" href="../_images/Lab15_SensorResponse.png"><img alt="../_images/Lab15_SensorResponse.png" class="align-center" src="../_images/Lab15_SensorResponse.png" style="width: 560px;" /></a>
<br>
<p>We will develop a function that converts raw ADC samples into distance measured from the wall. Let <span class="math notranslate nohighlight">\(n\)</span> be a 14-bit sample from the ADC (0 to 16383), and <span class="math notranslate nohighlight">\(d\)</span> be the distance in mm from the sensor to the wall. Then the distance in mm from the sensor to the wall is given by</p>
<p>In this lab, we will create a function to convert raw ADC samples into distances measured from a wall. Let‚Äôs use some variables to represent our measurements:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(n\)</span> represents a 14-bit sample from the ADC, ranging from 0 to 16383.</p></li>
<li><p><span class="math notranslate nohighlight">\(d\)</span> represents the distance in millimeters from the sensor to the wall.</p></li>
</ul>
<p>We‚Äôll calculate <span class="math notranslate nohighlight">\(d\)</span> with the formula:</p>
<div class="math notranslate nohighlight">
\[ d = \frac{m}{n - c} \]</div>
<p>where <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(c\)</span> are calibration coefficients that we will need to find through empirically testing.</p>
<p>Now, let‚Äôs consider the distance from the center of the robot to the wall, denoted as <span class="math notranslate nohighlight">\(L\)</span>:</p>
<div class="math notranslate nohighlight">
\[L = d + r = \frac{m}{n - c} + r\]</div>
<p>where <span class="math notranslate nohighlight">\(r\)</span> is the distance from the center of the robot to the distance sensor. You‚Äôll need to measure this value for each sensor.</p>
<p>Our second task is to classify the robot‚Äôs situation based on the readings from three distance sensors: left, center, and right. These sensors measure the distance from the center of the robot to the wall in millimeters. It‚Äôs essential to understand that the center of the robot serves as the common reference point for all three sensors.</p>
<p>As the robot approaches a decision point, we‚Äôll need to categorize its situation into one of the eight scenarios shown in the figure below. The variables ‚Äòleft,‚Äô ‚Äòcenter,‚Äô and ‚Äòright‚Äô in the figure represent the respective distances from the center of the robot to the wall.</p>
<a class="reference internal image-reference" href="../_images/Lab15_FirstCases.png"><img alt="../_images/Lab15_FirstCases.png" class="align-center" src="../_images/Lab15_FirstCases.png" style="width: 480px;" /></a>
<a class="reference internal image-reference" href="../_images/Lab15_SecondCases.png"><img alt="../_images/Lab15_SecondCases.png" class="align-center" src="../_images/Lab15_SecondCases.png" style="width: 480px;" /></a>
<br>
</section>
<section id="procedure">
<h2>üíª Procedure<a class="headerlink" href="#procedure" title="Permalink to this heading">#</a></h2>
<section id="complete-functions-in-adc14-c">
<h3>Complete functions in <code class="docutils literal notranslate"><span class="pre">ADC14.c</span></code><a class="headerlink" href="#complete-functions-in-adc14-c" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>This is part of Homework 15</strong></p></li>
<li><p>Complete <code class="docutils literal notranslate"><span class="pre">ADC0_InitSWTriggerCh17_14_16()</span></code> and <code class="docutils literal notranslate"><span class="pre">ADC_In17_14_16()</span></code> located in the <code class="docutils literal notranslate"><span class="pre">ADC14.c</span></code> file.</p></li>
<li><p>Refer to the instructions provided within the <code class="docutils literal notranslate"><span class="pre">ADC14.c</span></code> file to guide you through the completion of these functions.</p></li>
<li><p>Copy and paste the code into Gradescope to submit your Homework 15.</p></li>
</ul>
<p>Before starting this lab, review the solutions available in Gradescope to confirm that you have the correct code.  If the solutions are not published in Gradescope, go through your code with your instructor.</p>
<ul class="simple">
<li><p>The component block diagram of this lab is shown below.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/Lab15_CBD.png"><img alt="../_images/Lab15_CBD.png" class="align-center" src="../_images/Lab15_CBD.png" style="width: 760px;" /></a>
<br>
</section>
<section id="demo-program15-1">
<h3>Demo <code class="docutils literal notranslate"><span class="pre">Program15_1()</span></code><a class="headerlink" href="#demo-program15-1" title="Permalink to this heading">#</a></h3>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>You should understand the main code provided in every module. No such code will be provided for your final project, and you must write your main.c from scratch.</p>
</div>
<ul class="simple">
<li><p>Finish the implementation of <code class="docutils literal notranslate"><span class="pre">LCDOut1()</span></code> in the <code class="docutils literal notranslate"><span class="pre">Lab15_ADCmain.c</span></code> file.</p></li>
<li><p>Demo the functionality of <code class="docutils literal notranslate"><span class="pre">Program15_1()</span></code> by running it with raw digital sensor values as illustrated below.</p></li>
<li><p>Disregard the distance values displayed on the LCD screen for this particular section.</p></li>
<li><p><strong>Note</strong>: The distance sensors are powered by the chassis board.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/Lab15_ADC.png"><img alt="../_images/Lab15_ADC.png" class="align-center" src="../_images/Lab15_ADC.png" style="width: 260px;" /></a>
<br>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/oI-ZincragE" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>
<br>
</section>
<section id="calibrate-your-sensors">
<h3>Calibrate your sensors<a class="headerlink" href="#calibrate-your-sensors" title="Permalink to this heading">#</a></h3>
<p>For each IR sensor, you will empirically determine the two calibration constants (<span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(c\)</span>). Each sensor will have its own <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(c\)</span> constants. To determine these values, go to <a class="reference internal" href="lab15_calibration.html"><span class="doc std std-doc">Calibration</span></a>.</p>
</section>
<section id="complete-functions-in-irdistance-c">
<h3>Complete functions in <code class="docutils literal notranslate"><span class="pre">IRDistance.c</span></code><a class="headerlink" href="#complete-functions-in-irdistance-c" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Implement <code class="docutils literal notranslate"><span class="pre">LeftConvert()</span></code>, <code class="docutils literal notranslate"><span class="pre">RightConvert()</span></code>, and <code class="docutils literal notranslate"><span class="pre">CenterConvert()</span></code> in the <code class="docutils literal notranslate"><span class="pre">IRDistance.c</span></code> file.</p></li>
<li><p>You should have already determined the calibration coefficients, denoted as <span class="math notranslate nohighlight">\(n\)</span> and $c, in the previous section.</p></li>
<li><p>As discussed in the Synopsis section, these functions should return the actual distance, <span class="math notranslate nohighlight">\(L\)</span>, from <strong>the center of the robot to the wall</strong>.</p></li>
<li><p>Ensure that if the ADC value is less than the ADC value for 800 mm (e.g., 2244 as shown in the example on the calibration page), your function should return a distance of 800 mm.</p></li>
<li><p>Use integer values for all calculations in Code Composer Studio (CCS).</p></li>
<li><p>Make use of <code class="docutils literal notranslate"><span class="pre">enum</span></code> and <code class="docutils literal notranslate"><span class="pre">#define</span></code> for constants rather than hard-coding numbers. Deductions will be made for the use of hard-coded numbers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ADCMAX_xxxx</span></code> is the ADC value at 800mm.</p></li>
<li><p>Demo the <code class="docutils literal notranslate"><span class="pre">Program15_1</span></code> function running with accurate distance values on the LCD. Utilize distances of 150, 200, 250, and 300 mm for your demo. The error should be less than 50 mm during the demo. You can use one of the paper rulers available in the lab (donated by IKEA) for this purpose. While a live demo is preferred, a video demonstration is also acceptable. If you opt for a video demo, <strong>be sure to include your voice to clearly state the distances you are testing</strong>.</p></li>
</ul>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/BFKF1ZMtGAc" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>
<br>
</section>
<section id="write-and-test-the-classify-function">
<h3>Write and test the <code class="docutils literal notranslate"><span class="pre">Classify()</span></code> function.<a class="headerlink" href="#write-and-test-the-classify-function" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Open <code class="docutils literal notranslate"><span class="pre">Classifier.h</span></code> under the <code class="docutils literal notranslate"><span class="pre">inc</span></code> folder.</p></li>
<li><p>Add the following state representations to the enumerated type:</p></li>
</ul>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">ClassificationError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="n">LeftTooClose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="n">RightTooClose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="n">CenterTooClose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
<span class="n">Straight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span>
<span class="n">LeftTurn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span>
<span class="n">RightTurn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
<span class="n">TeeJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span>
<span class="n">LeftJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span>
<span class="n">RightJoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">13</span>
<span class="n">CrossRoad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">14</span>
<span class="n">Blocked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span>
</pre></div>
</div>
<br>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We put the enumerated types in the header file so that any code files that include the .h file can access these constants.</p>
</div>
<ul class="simple">
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">Classifier.c</span></code> file located in the project folder.</p></li>
<li><p>We will define the bounds using <code class="docutils literal notranslate"><span class="pre">#define</span></code> constants to enhance the clarity of the classification algorithm. You will have the opportunity to fine-tune these values during the final project to align them with the actual distances within the maze.</p></li>
</ul>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define SIDEMIN    212   </span><span class="c1">// smallest side distance to the wall in mm</span>
<span class="cp">#define SIDEMAX    354   </span><span class="c1">// largest side distance to wall in mm</span>
<span class="cp">#define CENTERMIN  150   </span><span class="c1">// min distance to the wall in the front</span>
<span class="cp">#define CENTEROPEN 600   </span><span class="c1">// distance to the wall between open/blocked</span>
<span class="cp">#define IRMIN      50    </span><span class="c1">// min possible reading of IR sensor</span>
<span class="cp">#define IRMAX      800   </span><span class="c1">// max possible reading of IR sensor</span>
</pre></div>
</div>
<br>
<ul class="simple">
<li><p>Develop the following classification algorithm, which will produce the following results:</p>
<ul>
<li><p>ClassificationError (0) if any of the sensors report distances <strong>less than</strong> 50 mm or <strong>greater than</strong> 800 mm.</p></li>
<li><p>LeftTooClose (1) if the left sensor reports a distance <strong>less than</strong> 212 mm.</p></li>
<li><p>RightTooClose (2) if the right sensor reports a distance <strong>less than</strong> 212 mm.</p></li>
<li><p>CenterTooClose (4) if the center sensor reports a distance <strong>less than</strong> 150 mm.</p></li>
<li><p>Combining conditions may result in multiple simultaneous danger states. For example, 5 indicates both CenterTooClose and LeftTooClose, while 7 implies all three directions are too close.</p></li>
<li><p>The remaining classifications (Straight (8) - Blocked (15)) depend on the states of the sensors.</p></li>
</ul>
</li>
</ul>
<p>First, let‚Äôs focus on the center sensor. As the robot approaches an intersection, the center sensor plays a crucial role in distinguishing between two scenarios:</p>
<ul class="simple">
<li><p>{Blocked, Right Turn, Left Turn, Tee Joint}: When the center sensor measures a distance <strong>less than</strong> 600 mm.</p></li>
<li><p>{Straight, Right Joint, Left Joint, Cross Road}: When the center sensor measures a distance <strong>greater than or equal to</strong> 600 mm.</p></li>
</ul>
<p>It‚Äôs important to note that, in scenarios involving long straight roads, there‚Äôs no defined maximum acceptable value for the sensors.</p>
<p>For our measurements, we consider a road that is 400 mm wide with side sensors placed at 45-degree angles. When the robot is positioned in the middle of the road in the straight or blocked scenarios, both side sensors placed at 45 degrees should read approximately 283 mm.</p>
<p>If the robot is within 50 mm from the center of the road in the straight or blocked scenarios, the side sensors can measure distances ranging from 212 mm (SIDEMIN) to 354 mm (SIDEMAX). The threshold of 354 mm (SIDEMAX) is used to determine whether it‚Äôs feasible to make a left or right turn at the upcoming intersection:</p>
<ul class="simple">
<li><p>A reading less than 354 mm (SIDEMAX) suggests that the turn path is not feasible.</p></li>
<li><p>A reading of 354 mm (SIDEMAX) or higher indicates that the turn path is feasible.</p></li>
</ul>
<p>After completing the implementation of the <code class="docutils literal notranslate"><span class="pre">Classify()</span></code> function in the <code class="docutils literal notranslate"><span class="pre">Classifier.c</span></code> file, proceed with the following steps.</p>
<ul class="simple">
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">Lab15_ADCmain.c</span></code> file in the project folder.</p></li>
<li><p>Scroll down to the <code class="docutils literal notranslate"><span class="pre">main()</span></code> function and make sure that the line with <code class="docutils literal notranslate"><span class="pre">Program15_2()</span></code> is uncommented while the other two are commented.</p></li>
<li><p>Add the variables <code class="docutils literal notranslate"><span class="pre">left</span></code>, <code class="docutils literal notranslate"><span class="pre">center</span></code>, <code class="docutils literal notranslate"><span class="pre">right</span></code>, <code class="docutils literal notranslate"><span class="pre">result</span></code>, <code class="docutils literal notranslate"><span class="pre">truth</span></code>, and <code class="docutils literal notranslate"><span class="pre">errors</span></code> to the Expressions tab.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">main()</span></code> by selecting the debug tool.</p></li>
<li><p>Monitor the value of <code class="docutils literal notranslate"><span class="pre">errors</span></code>. If it exceeds 0, utilize breakpoints to debug your <code class="docutils literal notranslate"><span class="pre">Classify()</span></code> function and observe the program‚Äôs state.‚Äù</p></li>
</ul>
<p>Please note that <code class="docutils literal notranslate"><span class="pre">Program15_2</span></code> focuses on testing corner cases. In the context of the <code class="docutils literal notranslate"><span class="pre">Classify()</span></code> function, there‚Äôs a wide range of possible inputs, with each of the three sensors varying from 50 to 800. This results in a total of <span class="math notranslate nohighlight">\(751^3\)</span> possibilities, which is equal to 423,564,751 unique inputs. While an exhaustive test (<code class="docutils literal notranslate"><span class="pre">Program15_3</span></code>) would cover all these inputs, the nature of the problem allows us to significantly reduce the number of test values while retaining testing accuracy. This reduction is achieved by strategically selecting test values around the threshold points. This practice, known as testing ‚Äúcorner cases,‚Äù enables us to minimize the number of test values from <span class="math notranslate nohighlight">\(751^3\)</span> to just 18. Specifically, we will test values that are within <span class="math notranslate nohighlight">\(\pm 1\)</span> of the threshold values, which include 50, 150, 212, 354, 600, and 800.</p>
</section>
<section id="demo-the-classify-function">
<h3>Demo the <code class="docutils literal notranslate"><span class="pre">Classify()</span></code> function.<a class="headerlink" href="#demo-the-classify-function" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Complete the <code class="docutils literal notranslate"><span class="pre">LCDOut4()</span></code> function for displaying data on the LCD.</p></li>
<li><p>Use the maze in the lab to test a combination of seven ‚Äútoo close‚Äù cases and eight normal cases.</p></li>
<li><p>Demo <code class="docutils literal notranslate"><span class="pre">Program15_4()</span></code> displaying the classifications on the LCD. Your demo should include at least three error cases (where <code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">scenario</span></code> is less than or equal to 7) and at least five non-error cases (where <code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">scenario</span></code> is greater than 7).</p></li>
<li><p>While a live demo is preferred, a video demo is also acceptable. If opting for a video demo, please <strong>include your voice to clearly explain the classifications you are testing</strong>.</p></li>
<li><p>Ensure that you provide comments in your code for clarity and push your code to your repository using git.</p></li>
</ul>
</section>
</section>
<section id="deliverables-2-extra-points">
<h2>üöö Deliverables (2 extra points)<a class="headerlink" href="#deliverables-2-extra-points" title="Permalink to this heading">#</a></h2>
<section id="deliverable-1">
<h3>Deliverable 1<a class="headerlink" href="#deliverable-1" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>[5 Points]</strong> Demo <code class="docutils literal notranslate"><span class="pre">Program15_1()</span></code> to display raw ADC data on the LCD. Note that the distance values on the LCD are not valid at this stage.</p></li>
</ul>
</section>
<section id="deliverable-2">
<h3>Deliverable 2<a class="headerlink" href="#deliverable-2" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>[5 Points]</strong> Calibrate your sensors. Submit three plots for your right, center, and left sensors.</p></li>
</ul>
</section>
<section id="deliverable-3">
<h3>Deliverable 3<a class="headerlink" href="#deliverable-3" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>[5 Points]</strong> Demo <code class="docutils literal notranslate"><span class="pre">Program15_1()</span></code> with accurate distances on the LCD.
Choose three distances (100, 300, and 500 mm) for each sensor and use a ruler in the lab for measurement. You can do a live demo, which is preferred, or provide a video demo. If you choose a video demo, ensure that you <strong>include your voice to clearly state the distances you are testing</strong>.</p></li>
</ul>
</section>
<section id="deliverable-4">
<h3>Deliverable 4<a class="headerlink" href="#deliverable-4" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>[5 Points]</strong> Provide a screenshot of the Expressions tab after running <code class="docutils literal notranslate"><span class="pre">Program15_2()</span></code>. Ensure that <code class="docutils literal notranslate"><span class="pre">left</span></code>, <code class="docutils literal notranslate"><span class="pre">center</span></code>, <code class="docutils literal notranslate"><span class="pre">right</span></code>, <code class="docutils literal notranslate"><span class="pre">result</span></code>, <code class="docutils literal notranslate"><span class="pre">truth</span></code>, and <code class="docutils literal notranslate"><span class="pre">errors</span></code> are visible in the Expressions tab.</p></li>
<li><p>Note that providing a screenshot before running the program will result in a grade of 0.</p></li>
</ul>
</section>
<section id="deliverable-5">
<h3>Deliverable 5<a class="headerlink" href="#deliverable-5" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>[5 Points]</strong> Demo <code class="docutils literal notranslate"><span class="pre">Program15_4()</span></code> to display the classifications on the LCD. Ensure you show at least three error cases (enum scenario &lt;= 7) and at least five non-error cases (enum scenario &gt; 7). You can do a live demo, which is preferred, or provide a video demo. If you choose a video demo, <strong>include your voice to clearly state the classifications you are testing</strong>.</p></li>
</ul>
</section>
<section id="deliverable-6">
<h3>Deliverable 6<a class="headerlink" href="#deliverable-6" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>[6.5 Points]</strong>  Ensure that you provide comments in your code for clarity and push your code to your repository using git.</p></li>
</ul>
<p>This lab was originally adapted from the <a class="reference external" href="https://university.ti.com/en/faculty/ti-robotics-system-learning-kit/ti-rslk-max-edition-curriculum">TI-RSLK MAX Solderless Maze Edition Curriculum</a> and has since been significantly modified.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Assignments"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="lab14.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">üî¨ Lab 14 Real-Time Systems</p>
      </div>
    </a>
    <a class="right-next"
       href="lab15_calibration.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">üìà Lab15 Sensor Calibration</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">üìå Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">üìú Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#procedure">üíª Procedure</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#complete-functions-in-adc14-c">Complete functions in <code class="docutils literal notranslate"><span class="pre">ADC14.c</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#demo-program15-1">Demo <code class="docutils literal notranslate"><span class="pre">Program15_1()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calibrate-your-sensors">Calibrate your sensors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#complete-functions-in-irdistance-c">Complete functions in <code class="docutils literal notranslate"><span class="pre">IRDistance.c</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#write-and-test-the-classify-function">Write and test the <code class="docutils literal notranslate"><span class="pre">Classify()</span></code> function.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#demo-the-classify-function">Demo the <code class="docutils literal notranslate"><span class="pre">Classify()</span></code> function.</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverables-2-extra-points">üöö Deliverables (2 extra points)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverable-1">Deliverable 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverable-2">Deliverable 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverable-3">Deliverable 3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverable-4">Deliverable 4</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverable-5">Deliverable 5</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverable-6">Deliverable 6</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Stan Baek
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      ¬© Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>