
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>🔬 Lab 4 Subroutines &#8212; Embedded Computer Systems I</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="../_static/tabs.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="🔬 Lab 5 Software Design" href="lab5.html" />
    <link rel="prev" title="✏️ HW 4 Subroutines" href="homework4.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/ece382.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Embedded Computer Systems I</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    ECE382 Embedded Computer Systems I
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Course Info
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../syllabus.html">
   🚩 Syllabus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../schedule.html">
   📆 Course Schedule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../assembly.html">
   🔧 Assembly
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../c_programming.html">
   🌜 C Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../faq.html">
   🙋 FAQ
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../resources.html">
   💎 Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NoPointer.html">
   🐍 No Pointer in Python?
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Assignments
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="homework1.html">
   ✏️ HW 1 Setting up CCS and Git
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="homework2.html">
   ✏️ HW 2 Assembly Basic
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab2.html">
   🔬 Lab 2 Assembly Basic
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="homework3.html">
   ✏️ HW 3 Memory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab3.html">
   🔬 Lab 3 Memory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="homework4.html">
   ✏️ HW 4 Subroutines
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   🔬 Lab 4 Subroutines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab5.html">
   🔬 Lab 5 Software Design
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab8.html">
   🔬 Lab 8 I/O Interface
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab10.html">
   🔬 Lab 10 Multithreading
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab11.html">
   🔬 Lab 11 Serial Ports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab12.html">
   🔬 Lab 12 Motors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab13.html">
   🔬 Lab 13 Timers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab14.html">
   🔬 Lab 14 Real-Time Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab15.html">
   🔬 Lab 15 ADC
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab15_calibration.html">
   📈 Lab15 Sensor Calibration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab16.html">
   🔬 Lab 16 Tachometer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab17.html">
   🔬 Lab 17 Control Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="project.html">
   🚀 Final Project
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/USAFA-ECE/ece382"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/USAFA-ECE/ece382/issues/new?title=Issue%20on%20page%20%2FAssignments/lab4.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/Assignments/lab4.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#objectives">
   📌 Objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#synopsis">
   📜 Synopsis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#arm-architecture-procedure-call-standard-aapcs">
     ARM Architecture Procedure Call Standard (AAPCS)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#procedure">
   💻 Procedure
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup">
     Setup
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#write-the-encrypt-subroutine">
     Write the
     <code class="docutils literal notranslate">
      <span class="pre">
       Encrypt
      </span>
     </code>
     subroutine
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#write-the-decrypt-subroutine">
     Write the
     <code class="docutils literal notranslate">
      <span class="pre">
       Decrypt
      </span>
     </code>
     subroutine
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#complete-and-execute-lab04-potter-asm">
     Complete and execute
     <code class="docutils literal notranslate">
      <span class="pre">
       Lab04_Potter.asm
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deliverables">
   🚚 Deliverables
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deliverable-1">
     Deliverable 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deliverable-2">
     Deliverable 2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deliverable-3">
     Deliverable 3
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>🔬 Lab 4 Subroutines</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#objectives">
   📌 Objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#synopsis">
   📜 Synopsis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#arm-architecture-procedure-call-standard-aapcs">
     ARM Architecture Procedure Call Standard (AAPCS)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#procedure">
   💻 Procedure
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup">
     Setup
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#write-the-encrypt-subroutine">
     Write the
     <code class="docutils literal notranslate">
      <span class="pre">
       Encrypt
      </span>
     </code>
     subroutine
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#write-the-decrypt-subroutine">
     Write the
     <code class="docutils literal notranslate">
      <span class="pre">
       Decrypt
      </span>
     </code>
     subroutine
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#complete-and-execute-lab04-potter-asm">
     Complete and execute
     <code class="docutils literal notranslate">
      <span class="pre">
       Lab04_Potter.asm
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deliverables">
   🚚 Deliverables
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deliverable-1">
     Deliverable 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deliverable-2">
     Deliverable 2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deliverable-3">
     Deliverable 3
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="lab-4-subroutines">
<h1>🔬 Lab 4 Subroutines<a class="headerlink" href="#lab-4-subroutines" title="Permalink to this headline">#</a></h1>
<section id="objectives">
<h2>📌 Objectives<a class="headerlink" href="#objectives" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Students should be able to write assembly procedures (also called subroutines or functions) that comply with the AAPCS.</p></li>
<li><p>Students should be able to write assembly conditional instructions and arithmetic operations.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are only two kinds of programming languages: those people always bitch about and those nobody uses. -Bjarne Stroustrup (creator of C++)</p>
</div>
</section>
<section id="synopsis">
<h2>📜 Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">#</a></h2>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>START EARLY!</strong> You need to write only 20 - 25 lines of assembly code, but it may take <strong>much longer</strong> than you expect. Start early and seek EI if needed!</p>
</div>
<p>In this lab, you will write a program that encrypts and decrypts a message using a simple cryptography technique. A simple, yet effective encryption technique is to <code class="docutils literal notranslate"><span class="pre">XOR</span></code> a piece of information with a key and send the result. The receiver must have the key in order to decrypt the message - which is accomplished simply by <code class="docutils literal notranslate"><span class="pre">XOR</span></code>-ing the encrypted data with the key.</p>
<p>Let’s say I wanted to send the binary byte <code class="docutils literal notranslate"><span class="pre">0b01100011</span></code> and my key was <code class="docutils literal notranslate"><span class="pre">0b11001010</span></code>. To encrypt, I <code class="docutils literal notranslate"><span class="pre">XOR</span></code> the two - the resulting byte is <code class="docutils literal notranslate"><span class="pre">0b10101001</span></code>. To decrypt, I <code class="docutils literal notranslate"><span class="pre">XOR</span></code> the result with the key - providing the original message, <code class="docutils literal notranslate"><span class="pre">0b01100011</span></code>.</p>
<p>A plain text message of arbitrary length is stored in ROM. Your job is to encrypt and then decrypt it given a key, which is also stored in ROM. The contents of the message are <a class="reference internal" href="../resources.html"><span class="doc std std-doc">ASCII Characters</span></a> each character is encoded in a single byte. All messages will end with the null character (‘\0’, ASCII value 0).</p>
<section id="arm-architecture-procedure-call-standard-aapcs">
<h3>ARM Architecture Procedure Call Standard (AAPCS)<a class="headerlink" href="#arm-architecture-procedure-call-standard-aapcs" title="Permalink to this headline">#</a></h3>
<p>The Arm architecture places few restrictions on how <em>general</em> purpose registers are used. If you want your code to interact with code that is written by someone else, or with code that is produced by a compiler, then you need to agree rules for register usage. For the Arm architecture, these rules are called the Procedure Call Standard (PCS).</p>
<p>The PCS specifies:</p>
<ul class="simple">
<li><p>Which registers are used to pass arguments into the function.</p></li>
<li><p>Which registers are used to return a value to the function doing the calling, known as the caller.</p></li>
<li><p>Which registers the function being called, which is known as the callee, can corrupt.</p></li>
<li><p>Which registers the callee cannot corrupt.</p></li>
</ul>
<p>reference: <a class="reference external" href="https://developer.arm.com/documentation/102374/0100/Procedure-Call-Standard">https://developer.arm.com/documentation/102374/0100/Procedure-Call-Standard</a></p>
<p>To elaborate on the standard:</p>
<ul class="simple">
<li><p>If there is one input parameter, it is passed in R0; two, R0-R1; three, R0-R2; four, R0-R3</p></li>
<li><p>If there is an output parameter, it is returned in R0</p></li>
<li><p>Functions can modify R0-R3, and R12 freely</p></li>
<li><p>If a function wishes to use R4-R11 it must save and restore them using the stack.</p></li>
<li><p>If a function calls another, then it must save and restore LR</p></li>
<li><p>Functions must balance the stack</p></li>
</ul>
<p>The entire AAPCS can be found <a href="https://github.com/ARM-software/abi-aa/releases/download/2022Q1/aapcs32.pdf" target="_blank">here</a></p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>It’s important to ensure that your assembly code complies with the AAPCS (ARM Architecture Procedure Call Standard). The AAPCS defines the standard for how subroutines are called and how registers are used in ARM assembly language.</p>
<p>The AAPCS is important because it ensures that code written by different people can be used together without any issues. It also makes it easier to write code that can be reused in different projects.</p>
<p>If you’re not sure whether your code complies with the AAPCS, you can check the ARM documentation or ask your instructor for help.</p>
</div>
</section>
</section>
<section id="procedure">
<h2>💻 Procedure<a class="headerlink" href="#procedure" title="Permalink to this headline">#</a></h2>
<section id="setup">
<h3>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Connect the LaunchPad to your computer via the provided USB cable.</p></li>
<li><p>Open Code Composer Studio (CCS) and select your workspace.</p></li>
<li><p>Ensure your Project Explorer is open on the left of the CCS screen.</p></li>
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">Lab04_Cryptography</span></code> project by double-clicking it.</p></li>
</ul>
</section>
<section id="write-the-encrypt-subroutine">
<h3>Write the <code class="docutils literal notranslate"><span class="pre">Encrypt</span></code> subroutine<a class="headerlink" href="#write-the-encrypt-subroutine" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Open <code class="docutils literal notranslate"><span class="pre">Lab04_Granger.asm</span></code> in the <code class="docutils literal notranslate"><span class="pre">Lab04_Cryptography</span></code> project.</p></li>
<li><p>Ensure the <code class="docutils literal notranslate"><span class="pre">main</span></code> function at line 58 in <code class="docutils literal notranslate"><span class="pre">Lab04_Granger.asm</span></code> is <strong>not commented</strong> out. Otherwise, uncomment it by deleting the semicolon(<code class="docutils literal notranslate"><span class="pre">;</span></code>) at the beginning of the line;</p></li>
</ul>
<div class="highlight-ASM notranslate"><div class="highlight"><pre><span></span><span class="c1">;main:    .asmfunc</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Ensure the <code class="docutils literal notranslate"><span class="pre">main</span></code> function at line 58 in <code class="docutils literal notranslate"><span class="pre">Lab04_Potter.asm</span></code> is <strong>commented</strong> out. Otherwise, comment it out by adding the semicolon(<code class="docutils literal notranslate"><span class="pre">;</span></code>) at the beginning of the line;</p></li>
<li><p>Read <code class="docutils literal notranslate"><span class="pre">Lab04_Granger.asm</span></code> carefully.  You need to understand the code before writing code in <code class="docutils literal notranslate"><span class="pre">cryptography.asm</span></code>.</p></li>
<li><p>Open <code class="docutils literal notranslate"><span class="pre">cryptography.asm</span></code>. and read the comments carefully.</p></li>
</ul>
<p><strong>Complete the <code class="docutils literal notranslate"><span class="pre">Encrypt</span></code> function</strong></p>
<ul class="simple">
<li><p>You need to load addresses into registers.</p></li>
<li><p>Then, load a byte of the message one at a time and then call the <code class="docutils literal notranslate"><span class="pre">XOR_bytes</span></code> function to encrypt it.  Which register do you need to use to pass arguments to a function?</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do <strong>NOT</strong> implement your own “xor”.  You <strong>must</strong> use the provided <code class="docutils literal notranslate"><span class="pre">XOR_bytes</span></code> function. It is declared at line 42, <code class="docutils literal notranslate"><span class="pre">.global</span> <span class="pre">XOR_bytes</span></code> and defined inside <code class="docutils literal notranslate"><span class="pre">xor_bytes.obj</span></code>, which is already complied. So, the actual implementation is hidden, and you cannot tell what registers are being used inside the function. All you know is it takes two arguments (say x and y) and returns the exclusive-or of x and y.  The <code class="docutils literal notranslate"><span class="pre">XOR_bytes</span></code> function complies with the AAPCS.</p>
</div>
<ul class="simple">
<li><p>After you xor two bytes, store the encrypted message byte to the memory.</p></li>
<li><p>Then, you need to check if the <strong>unencrypted</strong> message byte is the end of message (EOM), which is ‘#’.  If you loaded the message byte into R0-R3, it may have been corrupted after calling the <code class="docutils literal notranslate"><span class="pre">XOR_bytes</span></code> function because “functions can modify R0-R3, and R12 freely.”  But you have to use R0-R3 to pass arguments. How can you preserve the message byte?</p></li>
<li><p>If the <strong>unencrypted</strong> message byte is ‘#’, then you are done. Otherwise, retrieve the next byte of the message to encrypt and repeat.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For ‘#’, use the constant <code class="docutils literal notranslate"><span class="pre">EOM</span></code> defined in <code class="docutils literal notranslate"><span class="pre">cryptography.asm</span></code> at line 44.</p>
</div>
<div class="admonition-q-a admonition">
<p class="admonition-title">Q&amp;A</p>
<p>Q: How would it be possible to return a multi-byte message into a single register if I can only XOR one at a time?
<br>
A: It is not possible. You should load, XOR, and store one byte at a time.
<br></p>
<p>Q: I am struggling with the CMP statement in decrypt after I call the XOR_bytes. I do not know what comparing the R0 returned from XOR_bytes to the null character does.
<br>
A: The null character is the last character of the message, and that is why you’re comparing each char to it. It is to check if that’s the end of the message, like a terminating char. Also, you want to compare the decrpyted byte to the null character so you can tell when to leave the loop.
<br></p>
<p>Q: Is there an easy way to check if the encrypted message is correct?
<br>
A: If so, it is not encryption. 😆  An encrypted message will not be readable characters in the Characters view (It will probably display a bunch of dots).  Change it to the 32-bit Hex view. If you want to know whether your encryption works correctly or not, you need to manually XOR one byte at a time and compare it.</p>
</div>
</section>
<section id="write-the-decrypt-subroutine">
<h3>Write the <code class="docutils literal notranslate"><span class="pre">Decrypt</span></code> subroutine<a class="headerlink" href="#write-the-decrypt-subroutine" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Complete the <code class="docutils literal notranslate"><span class="pre">Decrypt</span></code> function.</p></li>
<li><p>You need to load addresses into registers.</p></li>
<li><p>Then, load a byte of the encrypted message one at a time and then call the <code class="docutils literal notranslate"><span class="pre">XOR_bytes</span></code> to decrypt it.  Which register do you need to use to pass arguments to a function?</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do <strong>NOT</strong> implement your own “xor”.  You <strong>must</strong> use the provided <code class="docutils literal notranslate"><span class="pre">XOR_bytes</span></code> function.</p>
</div>
<ul class="simple">
<li><p>After you xor two bytes, store the decrypted message byte to the memory.</p></li>
<li><p>Then, you need to check if the <strong>decrypted</strong> message byte is EOM.</p></li>
<li><p>If the <strong>decrypted</strong> message byte is EOM, then you are done. Otherwise, retrieve the next byte of the message to decrypt and repeat.</p></li>
<li><p>After execution of <code class="docutils literal notranslate"><span class="pre">Lab04_Granger.asm</span></code> provide the following screenshots.</p>
<ul>
<li><p>The addresses of each of the variables stored in RAM and ROM (use the Memory Browser and the pointers you created. You can search the Memory Browser by variable name or memory address).</p></li>
<li><p>The contents of <code class="docutils literal notranslate"><span class="pre">enc_msg</span></code>. Use Memory Browser and change the encoding style to <strong>32-bit Hex</strong>.</p></li>
<li><p>The contents of <code class="docutils literal notranslate"><span class="pre">dec_msg</span></code>. Use Memory Browser and change the encoding style to the <strong>correct</strong> format so that everyone can verify that the code works correctly.</p></li>
</ul>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>What is the correct encoding sytle? Your code encrypts and decrypts “Wingardium Leviosa!” After decrypting the spell, what do you expect to see?</p>
</div>
<a class="reference internal image-reference" href="../_images/Lab04_WingardiumLeviosa2.gif"><img alt="../_images/Lab04_WingardiumLeviosa2.gif" class="align-center" src="../_images/Lab04_WingardiumLeviosa2.gif" style="width: 640px;" /></a>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>It’s important to remember that function calls will overwrite the LR register and could overwrite registers R0-R3 and R12. If you’re calling multiple subroutines, you’ll need to make sure that you save the values of these registers before calling the subroutine and restore them after the subroutine has finished executing. You can use the PUSH and POP instructions to save and restore the values of these registers.</p>
</div>
</section>
<section id="complete-and-execute-lab04-potter-asm">
<h3>Complete and execute <code class="docutils literal notranslate"><span class="pre">Lab04_Potter.asm</span></code><a class="headerlink" href="#complete-and-execute-lab04-potter-asm" title="Permalink to this headline">#</a></h3>
<p>You intercepted the following encrypted message between Dr. Baek and Dr. York. You also overheard Dr. Baek telling Dr. York that the secret key is <em>the number of staircases at Hogwarts</em>.  Use your decrypt function to decrypt the Harry Potter’s spell and provide a screenshot of your Memory Browser showing the decrypted message.</p>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span><span class="nf">spell</span><span class="w">    </span><span class="no">.word</span><span class="w"> </span><span class="mi">0xEBFEF6CB</span><span class="p">,</span><span class="w"> </span><span class="mi">0xAEE1FAED</span><span class="p">,</span><span class="w"> </span><span class="mi">0xFCFAEFDE</span><span class="p">,</span><span class="w"> </span><span class="mi">0xE3FBE0E1</span><span class="p">,</span><span class="w"> </span><span class="mi">0x00008EAF</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Open <code class="docutils literal notranslate"><span class="pre">Lab04_Potter.asm</span></code> in the <code class="docutils literal notranslate"><span class="pre">Lab04_Cryptography</span></code> project.</p></li>
<li><p>Ensure the <code class="docutils literal notranslate"><span class="pre">main</span></code> function at line 58 in <code class="docutils literal notranslate"><span class="pre">Lab04_Potter.asm</span></code> is <strong>not commented</strong> out. Otherwise, uncomment it by deleting the semicolon(<code class="docutils literal notranslate"><span class="pre">;</span></code>) at the beginning of the line;</p></li>
</ul>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span><span class="c1">;main:    .asmfunc</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Ensure the <code class="docutils literal notranslate"><span class="pre">main</span></code> function at line 58 in <code class="docutils literal notranslate"><span class="pre">Lab04_Granger.asm</span></code> is <strong>commented</strong> out. Otherwise, comment it by adding a semicolon(<code class="docutils literal notranslate"><span class="pre">;</span></code>) at the beginning of the line;</p></li>
<li><p>Replace the <code class="docutils literal notranslate"><span class="pre">key</span></code> value at line 48 with the secret key. Please do not write “the number of staircases at Hogwarts” verbatim. You can ask Siri, Google, or ChatGPT.  It should be a 1-byte number. You don’t need to convert it to hex. You can enter a decimal number.</p></li>
<li><p>Execute <code class="docutils literal notranslate"><span class="pre">Lab04_Potter.asm</span></code> to decrypt the spell and provide the screenshot of your Memory Browser showing the decrypted message. You must select the correct encoding style showing the spell.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/Lab04_ExpectoPatronum.gif"><img alt="../_images/Lab04_ExpectoPatronum.gif" class="align-center" src="../_images/Lab04_ExpectoPatronum.gif" style="width: 640px;" /></a>
</section>
</section>
<section id="deliverables">
<h2>🚚 Deliverables<a class="headerlink" href="#deliverables" title="Permalink to this headline">#</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Your code <strong>must be compilable</strong>.  If your code throws any compile errors, you will get <strong>a grade of 0</strong> for the coding part.</p>
</div>
<section id="deliverable-1">
<h3>Deliverable 1<a class="headerlink" href="#deliverable-1" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><strong>[12 Points]</strong> Complete <code class="docutils literal notranslate"><span class="pre">cryptography.asm</span></code> and push your code to your repository. <code class="docutils literal notranslate"><span class="pre">Lab04_Granger.asm</span></code> will use your code to encrypt and decrypt the message in it. <strong>Write comments in your code.</strong></p></li>
</ul>
</section>
<section id="deliverable-2">
<h3>Deliverable 2<a class="headerlink" href="#deliverable-2" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><strong>[12 Points]</strong> Execute <code class="docutils literal notranslate"><span class="pre">Lab04_Granger.asm</span></code> and take screenshots of the following and submit them via Gradescope:</p>
<ul>
<li><p><strong>[6 Points]</strong> The contents of <code class="docutils literal notranslate"><span class="pre">enc_msg</span></code> after execution of <code class="docutils literal notranslate"><span class="pre">Lab04_Granger.asm</span></code>. Use the Memory Browser and change the format to <strong>32-bit Hex</strong>.</p></li>
<li><p><strong>[6 Points]</strong> The contents of <code class="docutils literal notranslate"><span class="pre">dec_msg</span></code> after execution of <code class="docutils literal notranslate"><span class="pre">Lab04_Granger.asm</span></code>. Use Memory Browser and change the encoding style to the <strong>correct</strong> format so that everyone can verify that the code works correctly.</p></li>
</ul>
</li>
</ul>
</section>
<section id="deliverable-3">
<h3>Deliverable 3<a class="headerlink" href="#deliverable-3" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><strong>[5.5 Points]</strong> Execute <code class="docutils literal notranslate"><span class="pre">Lab04_Potter.asm</span></code> to decrypt <code class="docutils literal notranslate"><span class="pre">spell</span></code> and provide the screenshot of your Memory Browser showing the decrypted message.</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Assignments"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="homework4.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">✏️ HW 4 Subroutines</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="lab5.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">🔬 Lab 5 Software Design</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Stan Baek<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>