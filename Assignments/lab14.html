
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>🔬 Lab 14 Real-Time Systems &#8212; Embedded Computer Systems I</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="../_static/tabs.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="🔬 Lab 15 ADC" href="lab15.html" />
    <link rel="prev" title="🔬 Lab 13 Timers" href="lab13.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/ece382.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Embedded Computer Systems I</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    ECE382 Embedded Computer Systems I
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Course Info
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../syllabus.html">
   🚩 Syllabus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../schedule.html">
   📆 Course Schedule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../assembly.html">
   🔧 Assembly
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../c_programming.html">
   🌜 C Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../faq.html">
   🙋 FAQ
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../resources.html">
   💎 Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NoPointer.html">
   🐍 No Pointer in Python?
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Assignments
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="homework1.html">
   ✏️ HW 1 Setting up CCS and Git
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="homework2.html">
   ✏️ HW 2 Assembly Basic
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab2.html">
   🔬 Lab 2 Assembly Basic
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="homework3.html">
   ✏️ HW 3 Memory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab3.html">
   🔬 Lab 3 Memory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="homework4.html">
   ✏️ HW 4 Subroutines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab4.html">
   🔬 Lab 4 Subroutines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab5.html">
   🔬 Lab 5 Software Design
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab8.html">
   🔬 Lab 8 I/O Interface
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab10.html">
   🔬 Lab 10 Multithreading
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab11.html">
   🔬 Lab 11 Serial Ports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab12.html">
   🔬 Lab 12 Motors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab13.html">
   🔬 Lab 13 Timers
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   🔬 Lab 14 Real-Time Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab15.html">
   🔬 Lab 15 ADC
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab15_calibration.html">
   📈 Lab15 Sensor Calibration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab16.html">
   🔬 Lab 16 Tachometer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lab17.html">
   🔬 Lab 17 Control Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="project.html">
   🚀 Final Project
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/USAFA-ECE/ece382"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/USAFA-ECE/ece382/issues/new?title=Issue%20on%20page%20%2FAssignments/lab14.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/Assignments/lab14.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#objectives">
   📌 Objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#synopsis">
   📜 Synopsis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#procedure">
   💻 Procedure
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup">
     Setup
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#complete-functions-in-bumpint-c">
     Complete functions in
     <code class="docutils literal notranslate">
      <span class="pre">
       BumpInt.c
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#demo-program14-2">
     Demo
     <code class="docutils literal notranslate">
      <span class="pre">
       Program14_2()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#complete-functions-for-program14-3">
     Complete functions for
     <code class="docutils literal notranslate">
      <span class="pre">
       Program14_3()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#make-your-robot-drive-in-a-square">
     Make your robot drive in a square.
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deliverables">
   🚚 Deliverables
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deliverable-1">
     Deliverable 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deliverable-2">
     Deliverable 2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deliverable-3">
     Deliverable 3
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>🔬 Lab 14 Real-Time Systems</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#objectives">
   📌 Objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#synopsis">
   📜 Synopsis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#procedure">
   💻 Procedure
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup">
     Setup
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#complete-functions-in-bumpint-c">
     Complete functions in
     <code class="docutils literal notranslate">
      <span class="pre">
       BumpInt.c
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#demo-program14-2">
     Demo
     <code class="docutils literal notranslate">
      <span class="pre">
       Program14_2()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#complete-functions-for-program14-3">
     Complete functions for
     <code class="docutils literal notranslate">
      <span class="pre">
       Program14_3()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#make-your-robot-drive-in-a-square">
     Make your robot drive in a square.
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deliverables">
   🚚 Deliverables
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deliverable-1">
     Deliverable 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deliverable-2">
     Deliverable 2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deliverable-3">
     Deliverable 3
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="lab-14-real-time-systems">
<h1>🔬 Lab 14 Real-Time Systems<a class="headerlink" href="#lab-14-real-time-systems" title="Permalink to this headline">#</a></h1>
<section id="objectives">
<h2>📌 Objectives<a class="headerlink" href="#objectives" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Students should be able to implement software for edge-triggered interrupts to detect collisions.</p></li>
<li><p>Students should be able to use shared global variables to communicate between threads.</p></li>
<li><p>Students should be able to use interrupt priority to define the execution order when servicing multiple concurrent events.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Any fool can write code that a computer can understand. Good programmers write code that humans can understand.</p>
</div>
</section>
<section id="synopsis">
<h2>📜 Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">#</a></h2>
<p>The goal of this lab is to use edge-triggered interrupts to detect collisions by the bump sensors while the robot is moving. A collision event should cause an interrupt, and reading the status of the bumper switches should occur in the interrupt service routine (ISR).</p>
<p>In the previous labs, we made the periodic interrupt a high priority because we wanted to run user tasks in real time.  For example, in Lab 10, we took the line-sensor measurements in real time.  However, in Lab 14, the collision task should have a priority even higher than the periodic measurements because a collision represents a dangerous condition that requires immediate service. In lab 8, you interfaced the bump sensors with the microcontroller. In this lab, you will shift the software servicing of the sensors from a periodic interrupt to an event-driven trigger.</p>
</section>
<section id="procedure">
<h2>💻 Procedure<a class="headerlink" href="#procedure" title="Permalink to this headline">#</a></h2>
<section id="setup">
<h3>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Go to ECE382 Teams &gt; General &gt; Files &gt; Class Materials &gt; SourceFiles.</p></li>
<li><p>Download <code class="docutils literal notranslate"><span class="pre">Lab14_RealTimeSystemsMain.c</span></code> from the Teams folder into your <code class="docutils literal notranslate"><span class="pre">/workspace/Lab14_RealTimeSystems</span></code> folder using Windows File Explorer (not Code Composer Studio).  You need to overwrite the existing file.  <strong>Caution</strong>: It must be in the <code class="docutils literal notranslate"><span class="pre">Lab14_RealTimeSystems</span></code> folder not in the <code class="docutils literal notranslate"><span class="pre">inc</span></code> folder.</p></li>
</ul>
</section>
<section id="complete-functions-in-bumpint-c">
<h3>Complete functions in <code class="docutils literal notranslate"><span class="pre">BumpInt.c</span></code><a class="headerlink" href="#complete-functions-in-bumpint-c" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><strong>This is part of Homework 14</strong></p></li>
<li><p>Complete <code class="docutils literal notranslate"><span class="pre">BumpInt_Init()</span></code> and <code class="docutils literal notranslate"><span class="pre">PORT4_IRQHandler()</span></code> in <code class="docutils literal notranslate"><span class="pre">BumpInt.c</span></code>.</p></li>
<li><p>Follow the instructions inside <code class="docutils literal notranslate"><span class="pre">BumpInt.c</span></code> to complete it.</p></li>
<li><p>Copy and paste the code in Gradescope to submit your Homework 14.</p></li>
</ul>
<p>Before starting the following sections, check the solutions to <code class="docutils literal notranslate"><span class="pre">BumpInt_Init()</span></code> and <code class="docutils literal notranslate"><span class="pre">PORT4_IRQHandler()</span></code> posted in Gradescope to ensure you have the correct code. If the solution is not published in Gradescope, go through your code with your instructor.</p>
</section>
<section id="demo-program14-2">
<h3>Demo <code class="docutils literal notranslate"><span class="pre">Program14_2()</span></code><a class="headerlink" href="#demo-program14-2" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Write <code class="docutils literal notranslate"><span class="pre">LCDOut2()</span></code>. Watch the video below to find what you need to display on the LCD.</p></li>
<li><p>Shown below is the component block diagram for this part of the lab.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/Lab14_ComponentBlockDiagram14-2.png"><img alt="../_images/Lab14_ComponentBlockDiagram14-2.png" class="align-center" src="../_images/Lab14_ComponentBlockDiagram14-2.png" style="width: 560px;" /></a>
<ul class="simple">
<li><p>Demo <code class="docutils literal notranslate"><span class="pre">Program14_2()</span></code> displaying the number of collisions and the bump data that identifies which bump switch is pressed. Explain why the number of collisions displayed in the LCD is incorrect.</p></li>
</ul>
<br>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/NP0i63dhgz8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<br>
Video Credit: C24 Chanon Mallanoo
</center>
<br>
</section>
<section id="complete-functions-for-program14-3">
<h3>Complete functions for <code class="docutils literal notranslate"><span class="pre">Program14_3()</span></code><a class="headerlink" href="#complete-functions-for-program14-3" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Write <code class="docutils literal notranslate"><span class="pre">Controller3()</span></code>, <code class="docutils literal notranslate"><span class="pre">Collision3()</span></code>, and <code class="docutils literal notranslate"><span class="pre">Program14_3()</span></code>.</p></li>
<li><p>As shown in the component block diagram below, there are two interrupts: TimerA1.0 and Port4.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/Lab14_ComponentBlockDiagram14-3.png"><img alt="../_images/Lab14_ComponentBlockDiagram14-3.png" class="align-center" src="../_images/Lab14_ComponentBlockDiagram14-3.png" style="width: 760px;" /></a>
<br>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You will construct component block diagrams for the final project.</p>
</div>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">Controller3()</span></code> function should be called by <code class="docutils literal notranslate"><span class="pre">TA1_0_IRQHandler</span></code>.</p></li>
<li><p>To make this happen, <code class="docutils literal notranslate"><span class="pre">TA1_0_IRQHandler</span></code> must know the address of the <code class="docutils literal notranslate"><span class="pre">Controller3()</span></code> function (function pointer).</p></li>
<li><p>When you initialize TimerA1 using <code class="docutils literal notranslate"><span class="pre">TimerA1_Init</span></code>, you should pass the function pointer as an argument.  Then, you need to assign the address of the function to the <code class="docutils literal notranslate"><span class="pre">TimerA1Task</span></code> variable defined at the top of <code class="docutils literal notranslate"><span class="pre">TimerA1.c</span></code>.</p></li>
<li><p>Then, you can call <code class="docutils literal notranslate"><span class="pre">Controller3()</span></code> inside <code class="docutils literal notranslate"><span class="pre">TA1_0_IRQHandler</span></code> using the function pointer, <code class="docutils literal notranslate"><span class="pre">TimerA1Task</span></code>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TimerA1Task is the address of <code class="docutils literal notranslate"><span class="pre">Controller3</span></code>, not the function itself. You must add the <code class="docutils literal notranslate"><span class="pre">*</span></code> symbol to call the function, i.e., <code class="docutils literal notranslate"><span class="pre">(*TimerA1Task)()</span></code>.</p>
</div>
<br>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Why do we use a function pointer? We want the interrupt service routines to perform various user-defined tasks, but we do not want to rewrite them every time we have a new task.  For example, we have different tasks for <code class="docutils literal notranslate"><span class="pre">TimerA1</span></code> to run, and we don’t have to rewrite <code class="docutils literal notranslate"><span class="pre">TimerA1.c</span></code>, but we can simply write functions performing the tasks and pass their addresses to <code class="docutils literal notranslate"><span class="pre">TimerA1</span></code>.</p>
</div>
<ul class="simple">
<li><p>Similarly, the <code class="docutils literal notranslate"><span class="pre">Collision3()</span></code> functions will be called by <code class="docutils literal notranslate"><span class="pre">PORT4_IRQHandler</span></code>.</p></li>
<li><p>To make this happen, you need to pass the address of <code class="docutils literal notranslate"><span class="pre">Collision3()</span></code> as an argument to <code class="docutils literal notranslate"><span class="pre">BumpInt_Init</span></code>.</p></li>
<li><p>The pointer <code class="docutils literal notranslate"><span class="pre">BumpTask</span></code> inside <code class="docutils literal notranslate"><span class="pre">BumpInt.c</span></code> holds the address of <code class="docutils literal notranslate"><span class="pre">Collision3</span></code>, and therefore <code class="docutils literal notranslate"><span class="pre">*BumpTask</span></code> is the <code class="docutils literal notranslate"><span class="pre">Collision3</span></code> function itself.</p></li>
<li><p>So, <code class="docutils literal notranslate"><span class="pre">(*BumpTask)(Bump_Read())</span></code> is the same as <code class="docutils literal notranslate"><span class="pre">Collision3(Bump_Read())</span></code>.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Collision3</span><span class="p">(</span><span class="n">Bump_Read</span><span class="p">());</span><span class="w"></span>
</pre></div>
</div>
<p>is the same as</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Bump_Read</span><span class="p">();</span><span class="w"></span>
<span class="n">Collision3</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>You know <span class="math notranslate nohighlight">\(f(g(x))\)</span> is the same as <span class="math notranslate nohighlight">\(y=g(x)\)</span> followed by <span class="math notranslate nohighlight">\(f(y)\)</span>.</p>
</div>
<ul class="simple">
<li><p>Inside <code class="docutils literal notranslate"><span class="pre">Lab14_RealTimeSystemsMain.c</span></code>, implement the <code class="docutils literal notranslate"><span class="pre">Controller3</span></code> function. You should <strong>not</strong> have a while- or for-loop inside <code class="docutils literal notranslate"><span class="pre">Controller3</span></code>.  Remember that the <code class="docutils literal notranslate"><span class="pre">Controller3</span></code> function will be called every 1 ms. If you have a loop or a delay inside an ISR, you are most likely doing something terribly wrong.</p></li>
<li><p>Complete <code class="docutils literal notranslate"><span class="pre">Program14_3()</span></code>.</p></li>
<li><p>Test <code class="docutils literal notranslate"><span class="pre">Program14_3()</span></code> without edge-triggered interrupts from the bump sensors. The robot should run the three commands indefinitely.</p></li>
<li><p>Implement Collision and test your bump sensors. Hitting a bump switch must stop the robot and restart the three commands from the beginning, which is <code class="docutils literal notranslate"><span class="pre">Motor_Backward</span></code>.</p></li>
<li><p>Demo <code class="docutils literal notranslate"><span class="pre">Program14_3</span></code> running a simple set of commands - <code class="docutils literal notranslate"><span class="pre">Motor_Backward</span></code>, <code class="docutils literal notranslate"><span class="pre">Motor_TurnRight</span></code>, and <code class="docutils literal notranslate"><span class="pre">Motor_Forward</span></code>. On a collision, the robot must stop and restart the set of commands.</p></li>
</ul>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/dmsQhTmzbmQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<br>
Video Credit: C24 Chanon Mallanoo
</center>
<br>
</section>
<section id="make-your-robot-drive-in-a-square">
<h3>Make your robot drive in a square.<a class="headerlink" href="#make-your-robot-drive-in-a-square" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Complete <code class="docutils literal notranslate"><span class="pre">Program14_4</span></code> to drive the robot in the maze.</p></li>
<li><p>You may need to adjust your drive-straight PWM values if one wheel is going faster/slower than the other.</p></li>
<li><p>The robot must start behind the start line shown in the figure below.</p></li>
<li><p>You are not allowed to intentionally bump into the walls to decide when to turn (cannot do the bump-n-turn algorithm).  You have to base your decision to turn on your velocity and time (dead reckoning).</p></li>
<li><p>Demo <code class="docutils literal notranslate"><span class="pre">Program14_4</span></code> driving the robot in a maze.</p></li>
<li><p><strong>[5 Bonus Points]</strong> After arriving at the goal, turn around, drive the maze in the opposite direction, and pass the start line.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/Lab14_DriveInMaze.png"><img alt="../_images/Lab14_DriveInMaze.png" class="align-center" src="../_images/Lab14_DriveInMaze.png" style="width: 560px;" /></a>
<br>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/mehYdqnOhfo" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<br>
Video Credit: C24 Chanon Mallanoo
</center>
<br>
<br>
<div class="admonition-q-a admonition">
<p class="admonition-title">Q&amp;A</p>
<p>Q: My robot only goes backward, and I think it is because the line that actually calls the motors to move is only called once. I’m not sure if I need to add it somewhere else in order to get it to call multiple times or if it is supposed to be called somewhere in an interrupt. Does anyone have anything for this?
<br>
A: I had that same problem, It is supposed to be called inside mainly the controller and collision function. Every time collision is called through the bump initializer, it should be running a control[currentstep].motor….etc</p>
</div>
</section>
</section>
<section id="deliverables">
<h2>🚚 Deliverables<a class="headerlink" href="#deliverables" title="Permalink to this headline">#</a></h2>
<section id="deliverable-1">
<h3>Deliverable 1<a class="headerlink" href="#deliverable-1" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><strong>[15 Points]</strong> Demo <code class="docutils literal notranslate"><span class="pre">Program14_2()</span></code> proving the edge-triggered interrupts are properly working.  Your LCD will display the number of collisions and the bump data that identifies which bump switch is pressed. Explain why the number of collisions displayed in the LCD is incorrect. Push your code to your repository using git. Write comments in your code.</p></li>
</ul>
</section>
<section id="deliverable-2">
<h3>Deliverable 2<a class="headerlink" href="#deliverable-2" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><strong>[15 Points]</strong> Demo <code class="docutils literal notranslate"><span class="pre">Program14_3()</span></code> running a simple set of commands - <code class="docutils literal notranslate"><span class="pre">Motor_Backward()</span></code>, <code class="docutils literal notranslate"><span class="pre">Motor_TurnRight()</span></code>, and <code class="docutils literal notranslate"><span class="pre">Motor_Forward()</span></code>. On a collision, the robot must stop and restart the set of commands.  Push your code to your repository using git. Write comments in your code.</p></li>
</ul>
</section>
<section id="deliverable-3">
<h3>Deliverable 3<a class="headerlink" href="#deliverable-3" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><strong>[20 Points]</strong>  Demo <code class="docutils literal notranslate"><span class="pre">Program14_4()</span></code> driving the robot in the maze.</p>
<ul>
<li><p>10 points for the first turn.</p></li>
<li><p>5 points for the second turn.</p></li>
<li><p>3 points for the third turn.</p></li>
<li><p>2 points for arriving at the goal.</p></li>
</ul>
</li>
<li><p><strong>[5 Bonus Points]</strong>  After arriving at the goal, turn around, drive the maze in the opposite direction, and pass the start line. It must turn around, and moving backward does not count.</p></li>
</ul>
<p>This lab has been adapted from the TI RSLK: <a class="reference external" href="https://university.ti.com/en/faculty/ti-robotics-system-learning-kit/ti-rslk-max-edition-curriculum">The Solderless Maze Edition curriculum</a></p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Assignments"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="lab13.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">🔬 Lab 13 Timers</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="lab15.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">🔬 Lab 15 ADC</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Stan Baek<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>